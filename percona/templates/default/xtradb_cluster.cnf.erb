#
# Generated by Chef for <%= node['hostname'] %>
#
# Local modifications will be overwritten.
#
[mysqld]

# Path to Galera library
wsrep_provider=/usr/lib/libgalera_smm.so

# Cluster connection URL contains the IPs of node#1, node#2 and node#3
# Empty gcomm address is being used when cluster is getting bootstrapped
wsrep_cluster_address=<%= @wsrep_cluster_address %>

# In order for Galera to work correctly binlog format should be ROW
binlog_format=ROW

# MyISAM storage engine has only experimental support
default_storage_engine=InnoDB
#enforce_storage_engine=InnoDB

# This is a recommended tuning variable for performance
innodb_locks_unsafe_for_binlog=1

# This changes how InnoDB autoincrement locks are managed and is a requirement for Galera
innodb_autoinc_lock_mode=2

# Node address
wsrep_node_address=<%= node['ipaddress'] %>

# Node name
wsrep_node_name=<%= node['hostname'] %>

# SST method
wsrep_sst_method=<%= node['percona']['sst_method'] %>

<% if node['percona']['sst_method'] == "xtrabackup" %>
# Authentication for SST method
wsrep_sst_auth="<%= node['percona']['sst_user'] %>:<%= @sst_password %>"
<% end %>

# Cluster name
wsrep_cluster_name=<%= node['percona']['cluster_name'] %>

<% if @master_count == 1 %>
# Recommended options when writing to a single node
wsrep_provider_options = "gcs.fc_limit = 256; gcs.fc_factor = 0.99; gcs.fc_master_slave = yes"
<% end %>